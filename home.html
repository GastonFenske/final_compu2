<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercados</title>
</head>
<body>

    <h1>Mercados que se pueden analizar</h1>
    <h2>Click para anlizar el siguiente mercado</h2>

    <script>
        

        // fetch api to http://127.0.0.1:1234/api/open-markets
        fetch('http://127.0.0.1:1234/api/open-markets')
        .then(response => response.json())
        .then(data => {
            console.log(data)
            // map data.open_markets to html
            data.open_markets.map((market) => {
                console.log(market)
                // create a new div
                const div = document.createElement('div');
                // create a new link
                const btn = document.createElement('button');

                btn.addEventListener('click', onTouch)

                // set the link href
                // link.href = 'http://127.0.0.1:1234/api/trade'
                // set the link text
                btn.innerText = market;
                // append the btn to the div
                div.appendChild(btn);
                // append the div to the body
                document.body.appendChild(div);
            })
        })

        const onTouch = (e) => {
            console.log(e.target.innerText)
            // fetch post api with body
            fetch('http://127.0.0.1:1234/api/trade', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    market: e.target.innerText
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data)
            })
        }

        import io from 'socket.io-client'
        const socket = io('http://127.0.0.1:8000')

        // socket.on('connect', () => {
        //     console.log('connected')
        // })

        socket.on('message', (message) => {
        console.log(message, 'message')

        // create a new div
        const div = document.createElement('div');
        // create a new title
        const title = document.createElement('h3');
        // send the tittle to the dom
        title.innerText = message.market
        // append the title to the div
        div.appendChild(title)
        // append the div to the body
        document.body.appendChild(div)

        })



    </script>
    
</body>
</html>